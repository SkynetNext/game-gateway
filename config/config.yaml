# Game Gateway 配置文件

server:
  listen_addr: ":8080"
  health_check_port: 9090
  metrics_port: 9091
  # Gateway Name for cluster communication (typically Pod Name)
  # This name is sent in gRPC metadata (gateway-name header)
  # Backend servers use this to identify the gateway
  # If empty, will use POD_NAME environment variable (recommended for K8s)
  gateway_name: "" # Leave empty to auto-detect from POD_NAME
  # Use gRPC for backend communication
  use_grpc: true

redis:
  # Redis 地址：生产环境使用 K8s 集群内 Redis
  # 开发环境可改为 localhost:6379
  addr: "10.1.0.8:6379"
  password: ""
  db: 0
  key_prefix: "game-gateway:"
  pool_size: 10
  min_idle_conns: 5
  dial_timeout: 5s
  read_timeout: 3s
  write_timeout: 3s

backend:
  # K8s Service DNS
  account_service: "account-server.hgame.svc.cluster.local:8080"
  version_service: "version-server.hgame.svc.cluster.local:8080"
  game_service: "game-server.hgame.svc.cluster.local:8080"

consul:
  # Consul 服务发现配置（可选）
  enabled: true
  # Consul 地址（例如：http://14.103.46.72:30557）
  address: "http://14.103.46.72:30557"
  # 要发现的服务名称（例如：gameserver）
  service_name: "gameserver"
  # 服务发现刷新间隔
  refresh_interval: 10s

routing:
  # 路由规则刷新间隔
  refresh_interval: 10s
  # Realm 映射刷新间隔
  realm_refresh_interval: 5s

connection_pool:
  # 最大连接数
  max_connections: 1000
  # 每个服务的最大连接数
  max_connections_per_service: 100
  # 连接空闲超时
  idle_timeout: 5m
  # 连接建立超时
  dial_timeout: 5s
  # 连接读取超时
  read_timeout: 30s
  # 连接写入超时
  write_timeout: 30s
  # 连接重试次数
  max_retries: 3
  # 重试延迟
  retry_delay: 100ms

# 安全配置
security:
  # 最大消息大小（字节），防止 DoS 攻击
  max_message_size: 1048576 # 1MB
  # 每个 IP 的最大连接数
  max_connections_per_ip: 10
  # 每个 IP 的连接速率限制（每秒连接数）
  connection_rate_limit: 5

# 追踪配置
tracing:
  # 是否启用 Trace ID 传播到后端服务
  # ⚠️ 警告：启用此选项需要后端服务支持扩展的 GateMsgHeader 格式（33 字节）
  # 如果禁用（默认），使用原始格式（9 字节），与现有 cluster 完全兼容
  # 默认：false（禁用，保持兼容性）
  enable_trace_propagation: true

# 优雅关闭超时
graceful_shutdown_timeout: 30s
