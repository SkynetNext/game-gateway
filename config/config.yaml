# Game Gateway Configuration File

server:
  listen_addr: ":8080"
  health_check_port: 9090
  metrics_port: 9091
  # Gateway Name for cluster communication (typically Pod Name)
  # This name is sent in gRPC metadata (gateway-name header)
  # Backend servers use this to identify the gateway
  # If empty, will use POD_NAME environment variable (recommended for K8s)
  gateway_name: "" # Leave empty to auto-detect from POD_NAME
  # Use gRPC for backend communication
  use_grpc: true

redis:
  # Redis address: use K8s cluster-internal Redis in production
  # For development, can be changed to localhost:6379
  addr: "10.1.0.8:6379"
  password: ""
  db: 0
  key_prefix: "game-gateway:"
  pool_size: 10
  min_idle_conns: 5
  dial_timeout: 5s
  read_timeout: 3s
  write_timeout: 3s

backend:
  # K8s Service DNS
  account_service: "account-server.hgame.svc.cluster.local:8080"
  version_service: "version-server.hgame.svc.cluster.local:8080"
  game_service: "game-server.hgame.svc.cluster.local:8080"

consul:
  # Consul service discovery configuration (optional)
  enabled: true
  # Consul address (using Consul Client Service, follows Kubernetes best practices)
  address: "http://consul-client.infrastructure.svc.cluster.local:8500"
  # Service name to discover (e.g., "game")
  service_name: "game"
  # Namespace filter (e.g., "hgame"), if empty will discover services from all namespaces
  namespace: "hgame"
  # Service discovery refresh interval
  refresh_interval: 10s

routing:
  # Routing rules refresh interval
  refresh_interval: 10s
  # Realm mapping refresh interval
  realm_refresh_interval: 5s

connection_pool:
  # Maximum number of connections
  max_connections: 1000
  # Maximum connections per service
  max_connections_per_service: 100
  # Connection idle timeout
  idle_timeout: 5m
  # Connection establishment timeout
  dial_timeout: 5s
  # Connection read timeout
  read_timeout: 30s
  # Connection write timeout
  write_timeout: 30s
  # Connection retry count
  max_retries: 3
  # Retry delay
  retry_delay: 100ms

# Security configuration
security:
  # Maximum message size (bytes), prevents DoS attacks
  max_message_size: 1048576 # 1MB
  # Maximum connections per IP
  max_connections_per_ip: 10
  # Connection rate limit per IP (connections per second)
  connection_rate_limit: 5

# Tracing configuration
tracing:
  # Whether to enable Trace ID propagation to backend services
  # ⚠️ Warning: Enabling this requires backend services to support extended GateMsgHeader format (33 bytes)
  # If disabled (default), uses original format (9 bytes), fully compatible with existing cluster
  # Default: false (disabled, maintains compatibility)
  enable_trace_propagation: true

# Graceful shutdown timeout
graceful_shutdown_timeout: 30s
